<section class="grid" ng-controller="GridCtrl">
    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" ng-style="mapBackgroundCssObject()" height="{{ gridHeight }}" width="100%" ng-mousedown="mouseDown($event)" ng-mouseup="mouseUp($event)" ng-mousemove="mouseMove($event)" ng-mouseleave="mouseLeave($event)" msd-wheel="zoom($event);">
        <defs>
            <pattern x="0" y="0" width="32" height="32" id="gridPattern"
                    patternUnits="userSpaceOnUse"
                    patternTransform="translate({{ translate.x }} {{ translate.y }}) scale({{ scale }})">

            <rect
                    x="0"
                    y="0"
                    width="32" height="32" fill-opacity="0"
             stroke="{{ map.gridline_color}}"
             stroke-width="2"
             stroke-opacity="{{ map.grid_opacity }}" />

            </pattern>
        </defs>

        <rect x="0" y="0" width="100%" height="100%" stroke-opacity="0"
              fill="url(#gridPattern)" style="pointer-events:none;" id="gridRect"/>

        <!-- someday I'll figure out how to do this :( ) -->
        <!--<g ng-include="'/partials/layers_svg.html'"></g>-->

        <g ng-controller="ListLayersCtrl" transform="translate({{ translate.x }} {{translate.y}}) scale({{ scale }})">
          <g ng-repeat="layer in layers | filter:isVisible"> </g>
        </g>

        <g ng-controller="MeasureToolCtrl" ng-show="toolData.measuring">
          <line
            x1="{{ startX() }}"
            y1="{{ startY() }}"
            x2="{{ stopX() }}"
            y2="{{ stopY() }}"
            stroke="black" stroke-width="9" stroke-linecap="round" />
          <line
            x1="{{ startX() }}"
            y1="{{ startY() }}"
            x2="{{ stopX() }}"
            y2="{{ stopY() }}"
            stroke="white" stroke-width="5" stroke-linecap="round" />
          <rect
            x="{{ transformX( midx() * 32 ) - 3}}"
            y="{{ transformY( midy() * 32 ) - 16 }}"
            width="{{ distance().toString().length * 12 }}"
            height="24"
            rx="8"
            ry="8"
          />
          <text
            x="{{ transformX( midx() * 32) }}"
            y="{{ transformY( midy() * 32) }}"
            fill="white"
            stroke="white"
          >{{ toolData.distance() }}</text>
        </g>
    </svg>
</section>
